"use strict";var courseModel=require("../../models/course/courseModel.js"),Instructor=require("../../models/users/instructorModel.js"),student=require("../../models/users/studentModel.js"),dashboardController=function(e,r){var t,n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(student.find());case 3:return t=e.sent,e.next=6,regeneratorRuntime.awrap(courseModel.find());case 6:return n=e.sent,e.next=9,regeneratorRuntime.awrap(s.find());case 9:if(s=e.sent,t&&n&&s){e.next=12;break}return e.abrupt("return",r.status(404).json({message:"Error while fetching Data"}));case 12:r.status(200).json({message:"Fetched Data",courses:n,students:t,Instructor:s}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),r.status(500).json({message:"Internal server error",error:e.t0.message});case 18:case"end":return e.stop()}},null,null,[[0,15]])},searchController=function(r,t){var n,s,o,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.query.q,e.next=4,regeneratorRuntime.awrap(courseModel.find({$or:[{title:{$regex:n,$options:"i"}}]}));case 4:return s=e.sent,e.next=7,regeneratorRuntime.awrap(Instructor.find({$or:[{firstname:{$regex:n,$options:"i"}},{lastname:{$regex:n,$options:"i"}},{email:{$regex:n,$options:"i"}}]}));case 7:return o=e.sent,e.next=10,regeneratorRuntime.awrap(student.find({$or:[{firstname:{$regex:n,$options:"i"}},{lastname:{$regex:n,$options:"i"}},{email:{$regex:n,$options:"i"}}]}));case 10:if(a=e.sent,s&&a&&o){e.next=13;break}return e.abrupt("return",t.status(404).json({message:"Not found"}));case 13:t.status(200).json({message:"Results fetched",Students:a,courses:s,InstructorData:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),t.status(500).json({message:"Internal server error",error:e.t0.message});case 19:case"end":return e.stop()}},null,null,[[0,16]])},createCourse=function(r,t){var n,s,o,a,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.body,s=n.title,o=n.price,a=n.description,u=r.params.instructorId,e.next=5,regeneratorRuntime.awrap(CourseModel.create({title:s,price:o,description:a,instructor:u}));case 5:c=e.sent,t.json(c),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.json(e.t0.message);case 12:case"end":return e.stop()}},null,null,[[0,9]])},uploadVideos=function(r,n){var t,s,o,a,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.params.courseId,s=r.body,o=s.title,a=s.videoTitle,e.next=5,regeneratorRuntime.awrap(CourseModel.findById(t));case 5:if(u=e.sent,c=u.section,r.file||r.file.buffer){e.next=9;break}return e.abrupt("return",n.status(400).json({error:"No file provided in the request"}));case 9:cloudinary.uploader.upload_stream({resource_type:"video"},function(r,t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r)return console.error("Error uploading to Cloudinary:",r),e.abrupt("return",n.status(500).json({error:"Error uploading to Cloudinary"}));e.next=3;break;case 3:return c.push({title:o,videos:[{title:a,url:t.secure_url}]}),e.next=6,regeneratorRuntime.awrap(u.save());case 6:n.status(201).json({message:"Video uploaded successfully",section:u.section});case 7:case"end":return e.stop()}})}).end(r.file.buffer),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Error uploading video:",e.t0),n.status(500).json({error:"Error uploading video"});case 16:case"end":return e.stop()}},null,null,[[0,12]])},resourceController=function(r,t){var n,s,o,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.courseId,s=r.body.title,r.user,o="".concat(r.file.destination,"/").concat(r.file.filename),e.next=7,regeneratorRuntime.awrap(CourseModel.findById(n).populate("resources"));case 7:return(a=e.sent).resources.push({title:s,url:o}),e.next=11,regeneratorRuntime.awrap(a.save());case 11:t.json(a),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),t.json(e.t0.message);case 17:case"end":return e.stop()}},null,null,[[0,14]])};module.exports={dashboardController:dashboardController,searchController:searchController,createCourse:createCourse,uploadVideos:uploadVideos,resourceController:resourceController};
//# sourceMappingURL=dashboardController.min.js.map
